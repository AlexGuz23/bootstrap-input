/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * For more JQuery Plugins visit http://plugins.krajee.com
 */
(function(e){var t="{preview}\n"+'<div class="input-group {class}">\n'+"   {caption}\n"+'   <div class="input-group-btn">\n'+"       {remove}\n"+"       {upload}\n"+"       {browse}\n"+"   </div>\n"+"</div>";var n='<div class="file-preview {class}">\n'+'   <div class="file-preview-status text-center text-success"></div>\n'+'   <div class="close fileinput-remove text-right">&times;</div>\n'+'   <div class="file-preview-thumbnails"></div>\n'+'   <div class="clearfix"></div>'+"</div>";var r='<div class="form-control file-caption {class}">\n'+'   <span class="glyphicon glyphicon-file"></span> <span class="file-caption-name"></span>\n'+"</div>";var i=function(t,n){return t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var s=function(e,t,n){return i(e)||i(e[t])?n:e[t]};var o=function(e,t){return typeof e!=="undefined"?e.match("image.*"):t.match(/\.(gif|png|jpe?g)$/i)};var u=function(e,t){return typeof e!=="undefined"?e.match("text.*"):t.match(/\.(txt|md|csv|htm|html|php|ini)$/i)};var a=function(e,t){return"<!--[if "+t+"]>"+e+"<![endif]-->"};var f=function(){return Math.round((new Date).getTime()+Math.random()*100)};var l=function(t,n){this.$element=e(t);this.showCaption=n.showCaption;this.showPreview=n.showPreview;this.showRemove=n.showRemove;this.showUpload=n.showUpload;this.showMessage=n.showMessage;this.captionClass=n.captionClass;this.previewClass=n.previewClass;this.mainClass=n.mainClass;this.mainTemplate=n.mainTemplate;this.previewTemplate=n.previewTemplate;this.captionTemplate=n.captionTemplate;this.browseLabel=n.browseLabel;this.browseIcon=n.browseIcon;this.browseClass=n.browseClass;this.removeLabel=n.removeLabel;this.removeIcon=n.removeIcon;this.removeClass=n.removeClass;this.uploadLabel=n.uploadLabel;this.uploadIcon=n.uploadIcon;this.uploadClass=n.uploadClass;this.uploadRoute=n.uploadRoute;this.msgLoading=n.msgLoading;this.msgProgress=n.msgProgress;this.msgSelected=n.msgSelected;this.previewFileType=n.previewFileType;this.wrapTextLength=n.wrapTextLength;this.wrapIndicator=n.wrapIndicator;this.isDisabled=this.$element.attr("disabled")||this.$element.attr("readonly");if(i(this.$element.attr("id"))){this.$element.attr("id",f())}this.$container=this.createContainer();this.$captionContainer=s(n,"elCaptionContainer",this.$container.find(".file-caption"));this.$caption=s(n,"elCaptionText",this.$container.find(".file-caption-name"));this.$previewContainer=s(n,"elPreviewContainer",this.$container.find(".file-preview"));this.$preview=s(n,"elPreviewImage",this.$container.find(".file-preview-thumbnails"));this.$previewStatus=s(n,"elPreviewStatus",this.$container.find(".file-preview-status"));this.$name=this.$element.attr("name")||n.name;this.$hidden=this.$container.find('input[type=hidden][name="'+this.$name+'"]');this.isIE=window.navigator.appName=="Microsoft Internet Explorer";if(this.$hidden.length===0){this.$hidden=e('<input type="hidden" />');this.$container.prepend(this.$hidden)}this.original={preview:this.$preview.html(),hiddenVal:this.$hidden.val()};this.listen()};l.prototype={constructor:l,listen:function(){var t=this;t.$element.on("change",e.proxy(t.change,t));e(t.$element[0].form).on("reset",e.proxy(t.reset,t));t.$container.find(".fileinput-remove").on("click",e.proxy(t.clear,t))},trigger:function(e){var t=this;t.$element.trigger("click");e.preventDefault()},clear:function(e){var t=this;if(e){e.preventDefault()}t.$hidden.val("");t.$hidden.attr("name",t.name);t.$element.attr("name","");if(t.isIE){t.$container.after(t.$element);t.$container.remove()}else{t.$element.val("")}if(e!==false){t.$element.trigger("change");t.$element.trigger("fileclear")}t.$preview.html("");t.$caption.html("");t.$container.removeClass("file-input-new").addClass("file-input-new")},reset:function(e){var t=this;t.clear(false);t.$hidden.val(t.original.hiddenVal);t.$preview.html(t.original.preview);t.$container.find(".fileinput-filename").text("");t.$element.trigger("filereset")},change:function(e){var t=this;var n=t.$element,r=n.get(0).files,i=r?r.length:1,s=n.val().replace(/\\/g,"/").replace(/.*\//,""),a=t.$preview,f=t.$previewContainer,l=t.$previewStatus,c=t.msgLoading,h=t.msgProgress,p=t.msgSelected,d,v=t.previewFileType,m=parseInt(t.wrapTextLength),g=t.wrapIndicator;if(e.target.files===undefined){d=e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]}else{d=e.target.files}if(d.length===0){return}a.html("");var y=d.length,t=t;for(var b=0;b<y;b++){(function(e){var t=e.name;var n=o(e.type,e.name);var r=u(e.type,e.name);if(a.length>0&&(v=="any"?n||r:v=="text"?r:n)&&typeof FileReader!=="undefined"){var i=new FileReader;l.html(c);f.addClass("loading");i.onload=function(e){var n="";if(r){var i=e.target.result;if(i.length>m){g=g.replace("{title}",i);i=i.substring(0,m-1)+g}n='<div class="file-preview-frame"><div class="file-preview-text" title="'+t+'">'+i+"</div></div>"}else{n='<div class="file-preview-frame"><img src="'+e.target.result+'" class="file-preview-image" title="'+t+'" alt="'+t+'"></div>'}a.append("\n"+n);if(b>=y-1){f.removeClass("loading");l.html("")}};i.onprogress=function(t){if(t.lengthComputable){var n=parseInt(t.loaded/t.total*100,10);var r=h.replace("{percent}",n).replace("{file}",e.name);l.html(r)}};if(r){i.readAsText(e)}else{i.readAsDataURL(e)}}else{a.append("\n"+'<div class="file-preview-frame"><div class="file-preview-other"><h2><i class="glyphicon glyphicon-file"></i></h2>'+t+"</div></div>")}})(d[b])}var w=i>1?p.replace("{n}",i):s;t.$caption.html(w);t.$container.removeClass("file-input-new");n.trigger("fileselect",[i,s])},createContainer:function(){var t=this;var n=e(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(t.renderMain());t.$element.before(n);n.find(".btn-file").append(t.$element);return n},renderMain:function(){var e=this;var t=e.previewTemplate.replace("{class}",e.previewClass);var n=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass;var r=e.captionTemplate.replace("{class}",n);return e.mainTemplate.replace("{class}",e.mainClass).replace("{preview}",t).replace("{caption}",r).replace("{upload}",e.renderUpload()).replace("{remove}",e.renderRemove()).replace("{browse}",e.renderBrowse())},renderBrowse:function(){var e=this,t=e.browseClass+" btn-file",n="";if(e.isDisabled){n=" disabled "}return'<div class="'+t+'"'+n+"> "+e.browseIcon+e.browseLabel+" </div>"},renderRemove:function(){var e=this,t=e.removeClass+" fileinput-remove fileinput-remove-button",n="";if(e.isDisabled){n=" disabled "}return'<button type="button" class="'+t+'"'+n+">"+e.removeIcon+e.removeLabel+"</button>"},renderUpload:function(){var e=this,t="",n="";if(e.isDisabled){n=" disabled "}if(i(e.uploadRoute)){t='<button type="submit" class="'+e.uploadClass+'"'+n+">"+e.uploadIcon+e.uploadLabel+"</button>"}else{t='<a href="'+e.uploadRoute+'" class="'+e.uploadClass+'"'+n+">"+e.uploadIcon+e.uploadLabel+"</a>"}return t}};e.fn.fileinput=function(t){return this.each(function(){var n=e(this),r=n.data("fileinput");if(!r){n.data("fileinput",r=new l(this,t))}if(typeof t=="string"){r[t]()}})};e.fn.fileinput=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),i=r.data("fileinput"),s=typeof t==="object"&&t;if(!i){r.data("fileinput",i=new l(this,e.extend({},e.fn.fileinput.defaults,s,e(this).data())))}if(typeof t==="string"){i[t].apply(i,n)}})};e.fn.fileinput.defaults={elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,showCaption:true,showPreview:true,showRemove:true,showUpload:true,showMessage:true,captionClass:"",previewClass:"",mainClass:"",mainTemplate:t,previewTemplate:n,captionTemplate:r,browseLabel:"Browse &hellip;",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeLabel:"Remove",removeIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',removeClass:"btn btn-danger",uploadLabel:"Upload",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadRoute:null,msgLoading:"Loading &hellip;",msgProgress:"Loaded {percent}% of {file}",msgSelected:"{n} files selected",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}">[&hellip;]</span>'};e(function(){var t=e("input.file[type=file]");if(t.length>0){t.fileinput()}})})(window.jQuery)